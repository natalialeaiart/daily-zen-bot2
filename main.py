import os
import telegram
import random
import replicate
from openai import OpenAI

# --- –ù–∞—Å—Ç—Ä–æ–π–∫–∏ API –∏ –∫–∞–Ω–∞–ª–∞ ---
openai_api_key = os.getenv("OPENAI_API_KEY")
telegram_token = os.getenv("TELEGRAM_BOT_TOKEN")
chat_id = "@dailyzendose" # –ó–∞–º–µ–Ω–∏—Ç–µ –Ω–∞ –≤–∞—à chat_id, –µ—Å–ª–∏ –Ω—É–∂–Ω–æ

client = OpenAI(api_key=openai_api_key)
bot = telegram.Bot(token=telegram_token)
replicate_client = replicate.Client(api_token=os.getenv("REPLICATE_API_TOKEN"))

# --- –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –¥–ª—è –ü–µ—Å–Ω–∏ –¥–Ω—è ---
SONGS_FILE = 'youtube_songs.txt'
INDEX_FILE = 'current_song_index.txt'

# --- –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –¥–ª—è –°—Ç–∏–ª–µ–π –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π ---
IMAGE_PROMPT_STYLES = [
    "Symbolic concept of {theme}: a vibrant minimalist aesthetic with lifelike elements. Clean lines, rich, harmonious colors, elegant vertical composition, full bleed, high detail, inspiring, 9:16 aspect ratio. Purely visual, no text elements.",
    "Symbolic concept of {theme}: photorealistic style infused with an artistic, aesthetic touch. Bright, natural lighting, vivid and appealing colors, perhaps a subtle touch of wonder, tall vertical image, highly detailed, immersive, 9:16 aspect ratio.Purely visual, no text elements.",
    "Symbolic concept of {theme}: modern aesthetic illustration, featuring a bold and beautiful color palette. Clean, contemporary design, an uplifting and lifelike feel, distinct vertical format, edge-to-edge clarity, 9:16 aspect ratio.Purely visual, no text elements.",
    "Symbolic concept of {theme}: serene and colorful aesthetic, blending elegant minimalism with organic, lifelike forms. Soft, diffused lighting creating a gentle mood, beautiful color gradients, elegant tall vertical design, high detail, 9:16 aspect ratio.Purely visual, no text elements.",
    "Symbolic concept of {theme}: a beautifully illustrated vertical scene, realistic yet imbued with a touch of artistic flair and wonder. Rich, vibrant, and lifelike colors, clear focus on the theme, minimalist yet meaningful background elements, highly detailed, 9:16 aspect ratio.Purely visual, no text elements."
]
CURRENT_STYLE_INDEX_FILE = 'current_style_index.txt'

# --- –ö–∞—Ç–µ–≥–æ—Ä–∏–∏ –∏ —Å—Ç–∏–ª–∏ –¥–ª—è –ó–∞–¥–∞–Ω–∏—è –î–Ω—è ---
THOUGHT_CATEGORIES = [
    "—Ñ–∏–ª–æ—Å–æ—Ñ–∏—è", "—é–º–æ—Ä –∂–∏–∑–Ω–∏", "—Å–∞–º–æ–ø–æ–∑–Ω–∞–Ω–∏–µ", "–º–∏–Ω–∏–º–∞–ª–∏–∑–º", "–ø—Å–∏—Ö–æ–ª–æ–≥–∏—è",
    "–æ—Å–æ–∑–Ω–∞–Ω–Ω–æ—Å—Ç—å", "–±–∏–∑–Ω–µ—Å", "—Ç–≤–æ—Ä—á–µ—Å—Ç–≤–æ", "–∫—Ä–∏—Ç–∏—á–µ—Å–∫–æ–µ –º—ã—à–ª–µ–Ω–∏–µ",
    "–º–æ—Ç–∏–≤–∞—Ü–∏—è", "—ç–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–π –∏–Ω—Ç–µ–ª–ª–µ–∫—Ç", "–ª–∏–¥–µ—Ä—Å—Ç–≤–æ", "–°–ø–æ—Ä—Ç" # <--- "–°–ø–æ—Ä—Ç" –î–û–ë–ê–í–õ–ï–ù
]
LAST_TOPIC_FILE = "last_topic.txt"

CATEGORY_STYLES = {
    "—Ñ–∏–ª–æ—Å–æ—Ñ–∏—è": {
        "personas": "–°–µ–Ω–µ–∫–∞, –ê–ª–∞–Ω –£–æ—Ç—Ç—Å –∏ –ú–∞—Ä–∫ –ê–≤—Ä–µ–ª–∏–π",
        "tone_description": "—Ä–∞–∑–º—ã—à–ª—è—é—â–∏–π, –≤–µ—á–Ω—ã–π, –Ω–∞–±–ª—é–¥–∞—é—â–∏–π. –ó–∞–¥–∞–Ω–∏—è –¥–æ–ª–∂–Ω—ã –∫–∞—Å–∞—Ç—å—Å—è ¬´—Å–º—ã—Å–ª–∞¬ª –∏ –ø–µ—Ä—Å–ø–µ–∫—Ç–∏–≤—ã –≤—Ä–µ–º–µ–Ω–∏. –ò—Å–ø–æ–ª—å–∑—É–π –≥–ª—É–±–æ–∫–∏–µ, –Ω–æ –ø–æ–Ω—è—Ç–Ω—ã–µ –º–µ—Ç–∞—Ñ–æ—Ä—ã, –≥–æ–≤–æ—Ä–∏ —Å–ø–æ–∫–æ–π–Ω–æ –∏ –º—É–¥—Ä–æ.",
        "emojis": {"task": "üìú", "benefit": "‚è≥", "action": "üåå"}
    },
    "—é–º–æ—Ä –∂–∏–∑–Ω–∏": {
        "personas": "–ö—É—Ä—Ç –í–æ–Ω–Ω–µ–≥—É—Ç, –î–∂–µ–Ω –°–∏–Ω—Å–µ—Ä–æ –∏ –†–∞–π–∞–Ω –•–æ–ª–∏–¥–µ–π (—Å –ª–µ–≥–∫–æ—Å—Ç—å—é)",
        "tone_description": "–∏—Ä–æ–Ω–∏—á–Ω—ã–π, –ª—ë–≥–∫–∏–π, –º–µ—Ç–∫–∏–π. –ó–∞–¥–∞–Ω–∏—è –¥–æ–ª–∂–Ω—ã –≤—ã–∑—ã–≤–∞—Ç—å ¬´—É–ª—ã–±–∫—É —Å–∫–≤–æ–∑—å –º—É–¥—Ä–æ—Å—Ç—å¬ª. –î–æ–±–∞–≤—å —â–µ–ø–æ—Ç–∫—É –∑–¥–æ—Ä–æ–≤–æ–≥–æ —Å–∞—Ä–∫–∞–∑–º–∞ –∏–ª–∏ –Ω–µ–æ–∂–∏–¥–∞–Ω–Ω—ã–π, –∑–∞–±–∞–≤–Ω—ã–π –ø–æ–≤–æ—Ä–æ—Ç.",
        "emojis": {"task": "üé≠", "benefit": "üòâ", "action": "üòÇ"}
    },
    "—Å–∞–º–æ–ø–æ–∑–Ω–∞–Ω–∏–µ": {
        "personas": "–ë—Ä–µ–Ω–µ –ë—Ä–∞—É–Ω –∏ –õ–∏–∑ –ì–∏–ª–±–µ—Ä—Ç",
        "tone_description": "–º—è–≥–∫–∏–π, –∏–Ω—Ç–∏–º–Ω—ã–π, —á–µ—Å—Ç–Ω—ã–π. –ó–∞–¥–∞–Ω–∏—è –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –≤ –¥—É—Ö–µ ¬´–ø–æ–≥–æ–≤–æ—Ä–∏ —Å —Å–æ–±–æ–π –ø–æ-–Ω–∞—Å—Ç–æ—è—â–µ–º—É¬ª. –ü–æ–æ—â—Ä—è–π —É—è–∑–≤–∏–º–æ—Å—Ç—å, —Å–∞–º–æ—Å–æ—Å—Ç—Ä–∞–¥–∞–Ω–∏–µ –∏ –ø—Ä–∏–Ω—è—Ç–∏–µ.",
        "emojis": {"task": "üí¨", "benefit": "üíñ", "action": "üíå"}
    },
    "–º–∏–Ω–∏–º–∞–ª–∏–∑–º": {
        "personas": "The Minimalists (–î–∂–æ—à—É–∞ –§–∏–ª–¥—Å –ú–∏–ª–±–µ—Ä–Ω –∏ –†–∞–π–∞–Ω –ù–∏–∫–æ–¥–µ–º—É—Å) –∏ –ú–∞—Ä–∏ –ö–æ–Ω–¥–æ",
        "tone_description": "—è—Å–Ω—ã–π, –ª–∞–∫–æ–Ω–∏—á–Ω—ã–π, –æ—Å–≤–æ–±–æ–∂–¥–∞—é—â–∏–π. –ó–∞–¥–∞–Ω–∏—è –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –ø—Ä–æ ¬´–º–µ–Ω—å—à–µ ‚Äî –∑–Ω–∞—á–∏—Ç –≥–ª—É–±–∂–µ¬ª. –§–æ–∫—É—Å–∏—Ä—É–π—Å—è –Ω–∞ –∏–∑–±–∞–≤–ª–µ–Ω–∏–∏ –æ—Ç –ª–∏—à–Ω–µ–≥–æ –∏ –ø–æ–∏—Å–∫–µ —Ä–∞–¥–æ—Å—Ç–∏ –≤ –ø—Ä–æ—Å—Ç–æ—Ç–µ.",
        "emojis": {"task": "üßπ", "benefit": "üßò", "action": "‚ú®"}
    },
    "–ø—Å–∏—Ö–æ–ª–æ–≥–∏—è": {
        "personas": "–ö–∞—Ä–ª –†–æ–¥–∂–µ—Ä—Å, –î–∂–æ—Ä–¥–∞–Ω –ü–∏—Ç–µ—Ä—Å–æ–Ω (–≤ –º—è–≥–∫–æ–º, –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—â–µ–º —Å—Ç–∏–ª–µ) –∏ –≠—Ä–∏–∫ –ë–µ—Ä–Ω",
        "tone_description": "–ø–æ–Ω–∏–º–∞—é—â–∏–π, –æ–±—ä—è—Å–Ω—è—é—â–∏–π, —Å –¥–æ–±—Ä–æ–π –≥–ª—É–±–∏–Ω–æ–π. –ó–∞–¥–∞–Ω–∏—è ‚Äî –∫–∞–∫ –∫–ª—é—á–∏–∫–∏ –∫ –ø–æ–Ω–∏–º–∞–Ω–∏—é —Å–µ–±—è –∏ –¥—Ä—É–≥–∏—Ö. –ò—Å–ø–æ–ª—å–∑—É–π –∞–Ω–∞–ª–æ–≥–∏–∏ –∏–∑ –ø–æ–≤—Å–µ–¥–Ω–µ–≤–Ω–æ–π –∂–∏–∑–Ω–∏, –≥–æ–≤–æ—Ä–∏ –¥–æ—Å—Ç—É–ø–Ω–æ.",
        "emojis": {"task": "üóùÔ∏è", "benefit": "üß†", "action": "ü§ù"}
    },
    "–æ—Å–æ–∑–Ω–∞–Ω–Ω–æ—Å—Ç—å": {
        "personas": "–¢–∏—Ç –ù–∞—Ç –•–∞–Ω, –û—à–æ –∏ –≠–∫—Ö–∞—Ä—Ç –¢–æ–ª–ª–µ",
        "tone_description": "–º–µ–¥–∏—Ç–∞—Ç–∏–≤–Ω—ã–π, –ø–æ—ç—Ç–∏—á–Ω—ã–π, –∑–∞–º–µ–¥–ª—è—é—â–∏–π. –ó–∞–¥–∞–Ω–∏—è ‚Äî –∫–∞–∫ –≥–ª–æ—Ç–æ–∫ —Ç–∏—à–∏–Ω—ã. –ò—Å–ø–æ–ª—å–∑—É–π –æ–±—Ä–∞–∑—ã –ø—Ä–∏—Ä–æ–¥—ã, –ø—Ä–æ—Å—Ç—ã–µ –ø—Ä–∞–∫—Ç–∏–∫–∏, –≥–æ–≤–æ—Ä–∏ —Å–ø–æ–∫–æ–π–Ω–æ –∏ —É–º–∏—Ä–æ—Ç–≤–æ—Ä—è—é—â–µ.",
        "emojis": {"task": "üïäÔ∏è", "benefit": "üåø", "action": "üå¨Ô∏è"}
    },
    "–±–∏–∑–Ω–µ—Å": {
        "personas": "–°—Ç–∏–≤–µ–Ω –ö–æ–≤–∏, –°–µ—Ç –ì–æ–¥–∏–Ω –∏ –¢–∏–º –§–µ—Ä—Ä–∏—Å",
        "tone_description": "—á—ë—Ç–∫–∏–π, –ø—Ä–∞–≥–º–∞—Ç–∏—á–Ω—ã–π, —Å –∏—Å–∫—Ä–æ–π. –ó–∞–¥–∞–Ω–∏—è ‚Äî –º–∏–∫—Ä–æ-–ø—Ä–æ–∫–∞—á–∫–∏ –Ω–∞–≤—ã–∫–æ–≤ –∏ –º—ã—à–ª–µ–Ω–∏—è. –ü—Ä–µ–¥–ª–∞–≥–∞–π –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ, –∏–∑–º–µ—Ä–∏–º—ã–µ –¥–µ–π—Å—Ç–≤–∏—è, –≤–¥–æ—Ö–Ω–æ–≤–ª—è–π –Ω–∞ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å.",
        "emojis": {"task": "üéØ", "benefit": "üìà", "action": "üí°"}
    },
    "—Ç–≤–æ—Ä—á–µ—Å—Ç–≤–æ": {
        "personas": "–≠–ª–∏–∑–∞–±–µ—Ç –ì–∏–ª–±–µ—Ä—Ç, –û—Å—Ç–∏–Ω –ö–ª–µ–æ–Ω –∏ –ù–∏–ª –ì–µ–π–º–∞–Ω",
        "tone_description": "–≤–¥–æ—Ö–Ω–æ–≤–ª—è—é—â–∏–π, –ø–æ—ç—Ç–∏—á–Ω—ã–π, –¥–µ—Ä–∑–∫–∏–π. –ó–∞–¥–∞–Ω–∏—è ‚Äî –∫–∞–∫ –∑–∞–∂–∏–≥–∞–ª–∫–∞ –≤–æ–æ–±—Ä–∞–∂–µ–Ω–∏—è. –ü–æ–æ—â—Ä—è–π —ç–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç—ã, –∏–≥—Ä—É –∏ –≤—ã—Ö–æ–¥ –∑–∞ —Ä–∞–º–∫–∏ –ø—Ä–∏–≤—ã—á–Ω–æ–≥–æ.",
        "emojis": {"task": "üé®", "benefit": "üåü", "action": "üöÄ"}
    },
    "–∫—Ä–∏—Ç–∏—á–µ—Å–∫–æ–µ –º—ã—à–ª–µ–Ω–∏–µ": {
        "personas": "–î–∞–Ω–∏—ç–ª—å –ö–∞–Ω–µ–º–∞–Ω, –Æ–≤–∞–ª—å –ù–æ–π –•–∞—Ä–∞—Ä–∏ –∏ –î–∂–æ—Ä–¥–∂ –ö–∞—Ä–ª–∏–Ω (–∏–Ω–æ–≥–¥–∞ —Å –µ–≥–æ –ø—Ä—è–º–æ—Ç–æ–π)",
        "tone_description": "–ø—Ä–æ–≤–æ–∫–∞—Ü–∏–æ–Ω–Ω—ã–π, –ª–æ–≥–∏—á–Ω—ã–π, —Å –≤—ã–∑–æ–≤–æ–º. –ó–∞–¥–∞–Ω–∏—è ‚Äî –∫–∞–∫ –≤—Å—Ç—Ä—è—Å–∫–∞ –¥–ª—è —É–º–∞. –ó–∞–¥–∞–≤–∞–π –Ω–µ—É–¥–æ–±–Ω—ã–µ –≤–æ–ø—Ä–æ—Å—ã, –ø—Ä–µ–¥–ª–∞–≥–∞–π –∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –∏ —Å–æ–º–Ω–µ–≤–∞—Ç—å—Å—è.",
        "emojis": {"task": "üßê", "benefit": "‚öñÔ∏è", "action": "ü§î"}
    },
    "–º–æ—Ç–∏–≤–∞—Ü–∏—è": {
        "personas": "–¢–æ–Ω–∏ –†–æ–±–±–∏–Ω—Å, –†–æ–±–∏–Ω –®–∞—Ä–º–∞ –∏ –ú—ç–ª –†–æ–±–±–∏–Ω—Å",
        "tone_description": "—ç–Ω–µ—Ä–≥–∏—á–Ω—ã–π, —Å—Ç—Ä–∞—Å—Ç–Ω—ã–π, —Ñ–æ–∫—É—Å–∏—Ä—É—é—â–∏–π. –ó–∞–¥–∞–Ω–∏—è ‚Äî –∫–∞–∫ –∑–∞—Ä—è–¥ –≤ —Å–ø–∏–Ω—É. –ò—Å–ø–æ–ª—å–∑—É–π –ø–æ–≤–µ–ª–∏—Ç–µ–ª—å–Ω–æ–µ –Ω–∞–∫–ª–æ–Ω–µ–Ω–∏–µ, —Å–ª–æ–≤–∞-–∞–∫—Ç–∏–≤–∞—Ç–æ—Ä—ã –∏ –ø—Ä–∏–∑—ã–≤—ã –∫ –Ω–µ–º–µ–¥–ª–µ–Ω–Ω–æ–º—É –¥–µ–π—Å—Ç–≤–∏—é.",
        "emojis": {"task": "üî•", "benefit": "üèÜ", "action": "‚ö°"}
    },
    "—ç–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–π –∏–Ω—Ç–µ–ª–ª–µ–∫—Ç": {
        "personas": "–°—å—é–∑–∞–Ω –î—ç–≤–∏–¥ –∏ –ú–∞—Ä—à–∞–ª–ª –†–æ–∑–µ–Ω–±–µ—Ä–≥",
        "tone_description": "—Å–æ—á—É–≤—Å—Ç–≤—É—é—â–∏–π, –≥–ª—É–±–æ–∫–æ —á–µ–ª–æ–≤–µ—á–Ω—ã–π. –ó–∞–¥–∞–Ω–∏—è ‚Äî –º—è–≥–∫–∞—è –ø—Ä–æ–∫–∞—á–∫–∞ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–µ–π —á—É—Ç–∫–æ—Å—Ç–∏ –∫ —Å–µ–±–µ –∏ –¥—Ä—É–≥–∏–º. –§–æ–∫—É—Å–∏—Ä—É–π—Å—è –Ω–∞ —á—É–≤—Å—Ç–≤–∞—Ö, –ø–æ—Ç—Ä–µ–±–Ω–æ—Å—Ç—è—Ö –∏ —ç–º–ø–∞—Ç–∏–∏.",
        "emojis": {"task": "üëÇ", "benefit": "‚ù§Ô∏è‚Äçü©π", "action": "ü´Ç"}
    },
    "–ª–∏–¥–µ—Ä—Å—Ç–≤–æ": {
        "personas": "–°–∞–π–º–æ–Ω –°–∏–Ω–µ–∫, –î–∂–æ–Ω –ú–∞–∫—Å–≤–µ–ª–ª –∏ –ë—Ä–µ–Ω–µ –ë—Ä–∞—É–Ω",
        "tone_description": "–≤–¥–æ—Ö–Ω–æ–≤–ª—è—é—â–∏–π, —É–≤–µ—Ä–µ–Ω–Ω—ã–π, —Å –≤—ã—Å–æ–∫–æ–π –ø–ª–∞–Ω–∫–æ–π. –ó–∞–¥–∞–Ω–∏—è ‚Äî –≤—ã–±–æ—Ä –±—ã—Ç—å —Å–∏–ª—å–Ω—ã–º –∏ –¥–æ–±—Ä—ã–º –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ. –ì–æ–≤–æ—Ä–∏ –æ –≤–ª–∏—è–Ω–∏–∏, –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏ –∏ —Å–ª—É–∂–µ–Ω–∏–∏.",
        "emojis": {"task": "üëë", "benefit": "üåç", "action": "ü§ù"}
    },
    "–°–ø–æ—Ä—Ç": { # <--- –ù–û–í–ê–Ø –ö–ê–¢–ï–ì–û–†–ò–Ø "–°–ø–æ—Ä—Ç" –î–û–ë–ê–í–õ–ï–ù–ê
        "personas": "–î–∂–µ–π–º—Å –ö–ª–∏—Ä (–∞–≤—Ç–æ—Ä ¬´Atomic Habits¬ª), –î—ç–≤–∏–¥ –ì–æ–≥–≥–∏–Ω—Å (–µ—Å–ª–∏ –Ω—É–∂–µ–Ω –∂—ë—Å—Ç–∫–∏–π –º–æ—Ç–∏–≤–∞—Ç–æ—Ä) –∏ –ö–µ–ª–ª–∏ –°—Ç–∞—Ä—Ä–µ—Ç (–æ—Å–æ–∑–Ω–∞–Ω–Ω—ã–π –ø–æ–¥—Ö–æ–¥ –∫ —Ç–µ–ª—É)",
        "tone_description": "–±–æ–¥—Ä—ã–π, —Ç–µ–ª–µ—Å–Ω—ã–π, –ø—Ä–æ–∫–∞—á–∏–≤–∞—é—â–∏–π. –ó–∞–¥–∞–Ω–∏—è –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –∫–∞–∫ –º–∏–∫—Ä–æ—à–∞–≥–∏ –∫ —Å–∏–ª–µ, –≤—ã–Ω–æ—Å–ª–∏–≤–æ—Å—Ç–∏ –∏ –ª—é–±–≤–∏ –∫ –¥–≤–∏–∂–µ–Ω–∏—é. –ü–æ–¥—á–µ—Ä–∫–Ω–∏ –≤–∞–∂–Ω–æ—Å—Ç—å —Ä–µ–≥—É–ª—è—Ä–Ω–æ—Å—Ç–∏, –º–∞–ª–µ–Ω—å–∫–∏—Ö –ø–æ–±–µ–¥ –∏ —Å–ª—É—à–∞–Ω–∏—è —Å–≤–æ–µ–≥–æ —Ç–µ–ª–∞.",
        "emojis": {"task": "üèãÔ∏è‚Äç‚ôÇÔ∏è", "benefit": "üí™", "action": "üèÜ"}
    }
}
# --- –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å —Ñ–∞–π–ª–∞–º–∏ ---
def read_song_list(filename):
    items = []
    try:
        with open(filename, 'r', encoding='utf-8') as f:
            for line in f:
                line = line.strip()
                if line and not line.startswith('#'):
                    items.append(line)
    except FileNotFoundError:
        print(f"–§–∞–π–ª {filename} –Ω–µ –Ω–∞–π–¥–µ–Ω. –°–ø–∏—Å–æ–∫ –ø–µ—Å–µ–Ω –±—É–¥–µ—Ç –ø—É—Å—Ç.")
        return []
    except Exception as e:
        print(f"–û—à–∏–±–∫–∞ —á—Ç–µ–Ω–∏—è —Ñ–∞–π–ª–∞ {filename}: {e}")
        return []
    return items

def read_current_index(filename):
    try:
        with open(filename, 'r', encoding='utf-8') as f:
            content = f.read().strip()
            return int(content) if content else -1
    except FileNotFoundError:
        print(f"–§–∞–π–ª –∏–Ω–¥–µ–∫—Å–∞ {filename} –Ω–µ –Ω–∞–π–¥–µ–Ω. –ù–∞—á–Ω–µ–º —Å –Ω–∞—á–∞–ª–∞.")
        return -1 # –ù–∞—á–∞—Ç—å —Å –ø–µ—Ä–≤–æ–≥–æ —ç–ª–µ–º–µ–Ω—Ç–∞, –µ—Å–ª–∏ —Ñ–∞–π–ª –Ω–µ –Ω–∞–π–¥–µ–Ω
    except ValueError:
        print(f"–û—à–∏–±–∫–∞ –∑–Ω–∞—á–µ–Ω–∏—è –≤ —Ñ–∞–π–ª–µ –∏–Ω–¥–µ–∫—Å–∞ {filename}. –ù–∞—á–Ω–µ–º —Å –Ω–∞—á–∞–ª–∞.")
        return -1
    except Exception as e:
        print(f"–û—à–∏–±–∫–∞ —á—Ç–µ–Ω–∏—è —Ñ–∞–π–ª–∞ –∏–Ω–¥–µ–∫—Å–∞ {filename}: {e}")
        return -1

def write_current_index(filename, index):
    try:
        with open(filename, 'w', encoding='utf-8') as f:
            f.write(str(index))
    except Exception as e:
        print(f"–û—à–∏–±–∫–∞ –∑–∞–ø–∏—Å–∏ –∏–Ω–¥–µ–∫—Å–∞ –≤ —Ñ–∞–π–ª {filename}: {e}")

# --- –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –º—É–¥—Ä–æ–π –º—ã—Å–ª–∏ –¥–Ω—è ---
print("–ù–∞—á–∞–ª–æ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è —Å–∫—Ä–∏–ø—Ç–∞.")

last_topic = None
if os.path.exists(LAST_TOPIC_FILE):
    with open(LAST_TOPIC_FILE, 'r', encoding='utf-8') as f:
        last_topic = f.read().strip()

available_topics = [t for t in THOUGHT_CATEGORIES if t != last_topic]
if not available_topics:
    available_topics = THOUGHT_CATEGORIES
selected_category = random.choice(available_topics)

with open(LAST_TOPIC_FILE, 'w', encoding='utf-8') as f:
    f.write(selected_category)

print(f"–í—ã–±—Ä–∞–Ω–∞ –∫–∞—Ç–µ–≥–æ—Ä–∏—è –¥–ª—è –º—ã—Å–ª–∏ –∏ –∑–∞–¥–∞–Ω–∏—è: {selected_category}")

prompt_thought = (
    f"–°–≥–µ–Ω–µ—Ä–∏—Ä—É–π –æ–¥–Ω—É –º—É–¥—Ä—É—é, –≤–¥–æ—Ö–Ω–æ–≤–ª—è—é—â—É—é –∏–ª–∏ —Ñ–∏–ª–æ—Å–æ—Ñ—Å–∫—É—é –º—ã—Å–ª—å –Ω–∞ —Ä—É—Å—Å–∫–æ–º —è–∑—ã–∫–µ, "
    f"–æ—Å–Ω–æ–≤–∞–Ω–Ω—É—é –Ω–∞ –∏–¥–µ—è—Ö –∏–∑ –∫–Ω–∏–≥–∏, –∫—É—Ä—Å–∞, —Ñ–∏–ª—å–º–∞, —Å—Ç–∞—Ç—å–∏ –∏–ª–∏ –∏–Ω—Ç–µ—Ä–≤—å—é –ø–æ —Ç–µ–º–µ ¬´{selected_category}¬ª. "
    "–≠—Ç–æ –Ω–µ –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å —Ü–∏—Ç–∞—Ç–∞, –∞ –∫—Ä–∞—Ç–∫–∞—è –º—ã—Å–ª—å –≤ –¥—É—Ö–µ –∏—Å—Ç–æ—á–Ω–∏–∫–∞. "
    "–í –∫–æ–Ω—Ü–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ —É–∫–∞–∂–∏ –∏—Å—Ç–æ—á–Ω–∏–∫ (–≤ —Å–∫–æ–±–∫–∞—Ö). "
    "–§–æ—Ä–º–∞—Ç –æ—Ç–≤–µ—Ç–∞ ‚Äî —Ç–æ–ª—å–∫–æ —Ç–µ–∫—Å—Ç –æ–¥–Ω–æ–π —Å—Ç—Ä–æ–∫–∏. –ë–µ–∑ –≤—Å—Ç—É–ø–ª–µ–Ω–∏–π –∏ –ø–æ—è—Å–Ω–µ–Ω–∏–π."
)

response_thought = client.chat.completions.create(
    model="gpt-4o-mini",
    messages=[{"role": "user", "content": prompt_thought}]
)
text_thought = response_thought.choices[0].message.content.strip()
quote_text = f"–ú—ã—Å–ª—å –¥–Ω—è ({selected_category}):\n\n{text_thought}"

# --- –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ç–µ–º—ã –∏ –≥–µ–Ω–µ—Ä–∞—Ü–∏—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è —á–µ—Ä–µ–∑ Replicate ---
theme_response = client.chat.completions.create(
    model="gpt-4o-mini",
    messages=[{"role": "user", "content": f"–í–æ—Ç —Ç–µ–∫—Å—Ç:\n\n{text_thought}\n\n–û–ø—Ä–µ–¥–µ–ª–∏ –µ–≥–æ –≥–ª–∞–≤–Ω—É—é —Ç–µ–º—É –æ–¥–Ω–∏–º-–¥–≤—É–º—è —Å–ª–æ–≤–∞–º–∏ (–Ω–∞ –∞–Ω–≥–ª–∏–π—Å–∫–æ–º) –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è."}]
)
theme_for_image = theme_response.choices[0].message.content.strip()
print(f"–¢–µ–º–∞ –¥–ª—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è: {theme_for_image}")

current_style_idx = read_current_index(CURRENT_STYLE_INDEX_FILE)
next_style_idx = (current_style_idx + 1) if current_style_idx != -1 else 0
if next_style_idx >= len(IMAGE_PROMPT_STYLES):
    next_style_idx = 0

selected_style_template = IMAGE_PROMPT_STYLES[next_style_idx]
image_prompt = selected_style_template.replace("{theme}", theme_for_image)
print(f"–ü—Ä–æ–º–ø—Ç –¥–ª—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è: {image_prompt}")

try:
    output = replicate_client.run(
        "stability-ai/sdxl:7762fd07cf82c948538e41f63f77d685e02b063e37e496e96eefd46c929f9bdc",
        input={
            "prompt": image_prompt,
            "width": 1024,
            "height": 1792,
            "num_inference_steps": 30,
            "guidance_scale": 7.5
        }
    )
    image_url = output[0]
    write_current_index(CURRENT_STYLE_INDEX_FILE, next_style_idx)
    bot.send_photo(chat_id=chat_id, photo=image_url, caption=quote_text)
    print(f"–ú—ã—Å–ª—å –¥–Ω—è –∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –ø–æ —Ç–µ–º–µ '{selected_category}' –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω—ã.")
except Exception as e:
    print(f"–û—à–∏–±–∫–∞ –ø—Ä–∏ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –∏–ª–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è: {e}")
    bot.send_message(chat_id=chat_id, text=quote_text) # –û—Ç–ø—Ä–∞–≤–∏—Ç—å —Ç–æ–ª—å–∫–æ —Ç–µ–∫—Å—Ç, –µ—Å–ª–∏ —Å –∫–∞—Ä—Ç–∏–Ω–∫–æ–π –ø—Ä–æ–±–ª–µ–º–∞
    print(f"–ú—ã—Å–ª—å –¥–Ω—è –ø–æ —Ç–µ–º–µ '{selected_category}' –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∞ –±–µ–∑ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è.")


# --- –ü–µ—Å–Ω—è –¥–Ω—è ---
youtube_songs = read_song_list(SONGS_FILE)
if youtube_songs:
    current_song_idx = read_current_index(INDEX_FILE)
    next_song_idx = (current_song_idx + 1) if current_song_idx != -1 else 0
    if next_song_idx >= len(youtube_songs):
        next_song_idx = 0

    if 0 <= next_song_idx < len(youtube_songs):
        song_url = youtube_songs[next_song_idx]
        bot.send_message(chat_id=chat_id, text=f"Song Of The Day - –ü–µ—Å–Ω—è –î–Ω—è üéßüåü\n\n{song_url}")
        write_current_index(INDEX_FILE, next_song_idx)
        print("–ü–µ—Å–Ω—è –¥–Ω—è –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∞.")
    else:
        print(f"–û—à–∏–±–∫–∞: next_song_idx ({next_song_idx}) –≤—ã—à–µ–ª –∑–∞ –ø—Ä–µ–¥–µ–ª—ã —Å–ø–∏—Å–∫–∞ –ø–µ—Å–µ–Ω (–¥–ª–∏–Ω–∞: {len(youtube_songs)}). –ü–µ—Å–Ω—è –Ω–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∞.")
else:
    print("–°–ø–∏—Å–æ–∫ –ø–µ—Å–µ–Ω –ø—É—Å—Ç –∏–ª–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω. –ü–µ—Å–Ω—è –¥–Ω—è –Ω–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∞.")

# --- –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∑–∞–¥–∞–Ω–∏—è –¥–Ω—è –ø–æ —Ç–µ–º–µ ---
print(f"–ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∑–∞–¥–∞–Ω–∏—è –¥–Ω—è –ø–æ —Ç–µ–º–µ: {selected_category}")

style_info = CATEGORY_STYLES.get(selected_category, {
    "personas": "–æ–ø—ã—Ç–Ω—ã–π –Ω–∞—Å—Ç–∞–≤–Ω–∏–∫",
    "tone_description": "–≤–¥–æ—Ö–Ω–æ–≤–ª—è—é—â–∏–π, —è—Å–Ω—ã–π –∏ –ø–æ–ª–µ–∑–Ω—ã–π. –ó–∞–¥–∞–Ω–∏–µ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –ª–µ–≥–∫–∏–º –¥–ª—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∏ –∏–Ω—Ç–µ—Ä–µ—Å–Ω—ã–º.",
    "emojis": {"task": "üí°", "benefit": "üå±", "action": "üöÄ"} # –î–µ—Ñ–æ–ª—Ç–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è
})

personas = style_info["personas"]
tone_description = style_info["tone_description"]
task_emoji = style_info["emojis"]["task"]
benefit_emoji = style_info["emojis"]["benefit"]
action_emoji = style_info["emojis"]["action"]

task_prompt = (
    f"–¢—ã ‚Äî –≤–∏—Ä—Ç—É–∞–ª—å–Ω—ã–π –Ω–∞—Å—Ç–∞–≤–Ω–∏–∫, –∫–æ—Ç–æ—Ä—ã–π —Å–µ–≥–æ–¥–Ω—è –≥–æ–≤–æ—Ä–∏—Ç –≥–æ–ª–æ—Å–æ–º –∏ –º—É–¥—Ä–æ—Å—Ç—å—é {personas} –ø–æ —Ç–µ–º–µ ¬´{selected_category}¬ª. "
    f"–¢–≤–æ—è –∑–∞–¥–∞—á–∞ ‚Äî –ø—Ä–∏–¥—É–º–∞—Ç—å –æ–¥–Ω–æ –Ω–µ–±–æ–ª—å—à–æ–µ, –Ω–æ –æ—á–µ–Ω—å –ø–æ–ª–µ–∑–Ω–æ–µ –∑–∞–¥–∞–Ω–∏–µ –Ω–∞ –¥–µ–Ω—å –¥–ª—è —ç—Ç–æ–π —Ç–µ–º—ã.\n"
    f"–°—Ç–∏–ª—å –∏–∑–ª–æ–∂–µ–Ω–∏—è: {tone_description}.\n\n"
    "–ó–∞–¥–∞–Ω–∏–µ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å:\n"
    "1. –õ–µ–≥–∫–æ –≤—ã–ø–æ–ª–Ω–∏–º—ã–º —Å–µ–≥–æ–¥–Ω—è.\n"
    "2. –ò–Ω—Ç–µ—Ä–µ—Å–Ω—ã–º –∏ –Ω–µ—Å–∫—É—á–Ω—ã–º.\n"
    "3. –ü–æ-–Ω–∞—Å—Ç–æ—è—â–µ–º—É –ø–æ–ª–µ–∑–Ω—ã–º –¥–ª—è —á–µ–ª–æ–≤–µ–∫–∞.\n\n"
    "–°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ç–≤–æ–µ–≥–æ –æ—Ç–≤–µ—Ç–∞ –î–û–õ–ñ–ù–ê –ë–´–¢–¨ –°–¢–†–û–ì–û —Å–ª–µ–¥—É—é—â–µ–π (–∏—Å–ø–æ–ª—å–∑—É–π –∏–º–µ–Ω–Ω–æ —ç—Ç–∏ —ç–º–æ–¥–∑–∏ –∏ Markdown –¥–ª—è –≤—ã–¥–µ–ª–µ–Ω–∏—è –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤ –∂–∏—Ä–Ω—ã–º):\n"
    f"{task_emoji} *–ó–∞–¥–∞–Ω–∏–µ –¥–Ω—è:*\n[–ó–¥–µ—Å—å —Ç–µ–∫—Å—Ç —Å–∞–º–æ–≥–æ –∑–∞–¥–∞–Ω–∏—è. –ë—É–¥—å –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–º –∏ —è—Å–Ω—ã–º. –ù–µ –±–æ–ª–µ–µ 2-3 –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–π.]\n\n"
    f"{benefit_emoji} *–í —á—ë–º –ø–æ–ª—å–∑–∞?*\n[–ó–¥–µ—Å—å –∫–æ—Ä–æ—Ç–∫–æ–µ, –Ω–æ —ë–º–∫–æ–µ –æ–±—ä—è—Å–Ω–µ–Ω–∏–µ, –ø–æ—á–µ–º—É —ç—Ç–æ –∑–∞–¥–∞–Ω–∏–µ —Å—Ç–æ–∏—Ç –≤—ã–ø–æ–ª–Ω–∏—Ç—å. –ü–æ–¥—á–µ—Ä–∫–Ω–∏ —Ü–µ–Ω–Ω–æ—Å—Ç—å. –ù–µ –±–æ–ª–µ–µ 1-2 –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–π.]\n\n"
    f"{action_emoji} *–ö–∞–∫ –¥–µ–π—Å—Ç–≤–æ–≤–∞—Ç—å?*\n[–ó–¥–µ—Å—å –ø—Ä–∏–∑—ã–≤ –∫ –¥–µ–π—Å—Ç–≤–∏—é. –ü—Ä–µ–¥–ª–æ–∂–∏, –∫–∞–∫ –º–æ–∂–Ω–æ –ø–æ–¥–µ–ª–∏—Ç—å—Å—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞–º–∏ –∏–ª–∏ –º—ã—Å–ª—è–º–∏ –≤ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è—Ö (–Ω–∞–ø—Ä–∏–º–µ—Ä, –Ω–∞–±–ª—é–¥–µ–Ω–∏—è–º–∏, —Ñ–æ—Ç–æ, –∏–Ω—Å–∞–π—Ç–∞–º–∏, —Å–ª–æ–≤–∞–º–∏, –≤–ø–µ—á–∞—Ç–ª–µ–Ω–∏—è–º–∏). –°–¥–µ–ª–∞–π —ç—Ç–æ –ø—Ä–∏–≥–ª–∞—à–∞—é—â–∏–º –∏ –º–æ—Ç–∏–≤–∏—Ä—É—é—â–∏–º. –ù–µ –±–æ–ª–µ–µ 1-2 –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–π.]\n\n"
    "–í–ê–ñ–ù–û:\n"
    "- –ù–µ –∏—Å–ø–æ–ª—å–∑—É–π –Ω—É–º–µ—Ä–æ–≤–∞–Ω–Ω—ã–µ –∏–ª–∏ –º–∞—Ä–∫–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Å–ø–∏—Å–∫–∏ –≤–Ω—É—Ç—Ä–∏ –æ–ø–∏—Å–∞–Ω–∏—è –∑–∞–¥–∞–Ω–∏—è, –ø–æ–ª—å–∑—ã –∏–ª–∏ –ø—Ä–∏–∑—ã–≤–∞ –∫ –¥–µ–π—Å—Ç–≤–∏—é (–∫—Ä–æ–º–µ —Ç–µ—Ö, —á—Ç–æ —É–∂–µ –µ—Å—Ç—å –≤ —Å—Ç—Ä—É–∫—Ç—É—Ä–µ).\n"
    "- –ü–∏—à–∏ –≤–¥–æ—Ö–Ω–æ–≤–ª—è—é—â–µ, –Ω–æ –±–µ–∑ –ª–∏—à–Ω–µ–π '–≤–æ–¥—ã'. –ö–∞–∂–¥–æ–µ —Å–ª–æ–≤–æ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –Ω–∞ —Å–≤–æ–µ–º –º–µ—Å—Ç–µ.\n"
    "- –£–±–µ–¥–∏—Å—å, —á—Ç–æ —Ç–µ–∫—Å—Ç –ª–µ–≥–∫–æ —á–∏—Ç–∞–µ—Ç—Å—è –∏ –ø–æ–Ω—è—Ç–µ–Ω —à–∏—Ä–æ–∫–æ–π –∞—É–¥–∏—Ç–æ—Ä–∏–∏.\n"
    "- –ù–µ –ø–∏—à–∏ –Ω–∏–∫–∞–∫–∏—Ö –≤—Å—Ç—É–ø–ª–µ–Ω–∏–π –∏–ª–∏ –∑–∞–∫–ª—é—á–µ–Ω–∏–π –∑–∞ –ø—Ä–µ–¥–µ–ª–∞–º–∏ —É–∫–∞–∑–∞–Ω–Ω–æ–π —Å—Ç—Ä—É–∫—Ç—É—Ä—ã. –¢–æ–ª—å–∫–æ —Ç—Ä–∏ –±–ª–æ–∫–∞, –∫–∞–∫ –æ–ø–∏—Å–∞–Ω–æ –≤—ã—à–µ.\n"
    "- –£–ª–æ–∂–∏ –≤—Å—ë –∑–∞–¥–∞–Ω–∏–µ, –ø–æ–ª—å–∑—É –∏ –ø—Ä–∏–∑—ã–≤ –≤ –∫–æ—Ä–æ—Ç–∫–∏–π, —ë–º–∫–∏–π —Ç–µ–∫—Å—Ç. –û–±—â–∏–π –æ–±—ä–µ–º –æ—Ç–≤–µ—Ç–∞ –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –Ω–µ–±–æ–ª—å—à–∏–º.\n\n"
    f"–°–æ–∑–¥–∞–π —É–Ω–∏–∫–∞–ª—å–Ω–æ–µ –∑–∞–¥–∞–Ω–∏–µ –¥–ª—è —Ç–µ–º—ã ¬´{selected_category}¬ª, —Å—Ç—Ä–æ–≥–æ —Å–ª–µ–¥—É—è –≥–æ–ª–æ—Å—É {personas}, –∏—Ö —Ç–æ–Ω—É ({tone_description}), –∏ —É–∫–∞–∑–∞–Ω–Ω–æ–π —Å—Ç—Ä—É–∫—Ç—É—Ä–µ —Å —ç–º–æ–¥–∑–∏ ({task_emoji}, {benefit_emoji}, {action_emoji}) –∏ Markdown –¥–ª—è –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤."
)

task_response = client.chat.completions.create(
    model="gpt-4o-mini", # –∏–ª–∏ gpt-4o –¥–ª—è –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω–æ –±–æ–ª–µ–µ –∫–∞—á–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö —Å—Ç–∏–ª–∏–∑–∞—Ü–∏–π
    messages=[{"role": "user", "content": task_prompt}]
)
generated_task_text = task_response.choices[0].message.content.strip()

# –§–æ—Ä–º–∏—Ä—É–µ–º –∑–∞–≥–æ–ª–æ–≤–æ–∫ –¥–ª—è –ø–æ—Å—Ç–∞ —Å –∑–∞–¥–∞–Ω–∏–µ–º
task_post_header = f"‚ú® *–ó–∞–¥–∞–Ω–∏–µ –¥–Ω—è: {selected_category.capitalize()}*"
# –ò—Ç–æ–≥–æ–≤—ã–π —Ç–µ–∫—Å—Ç –ø–æ—Å—Ç–∞ (–∑–∞–≥–æ–ª–æ–≤–æ–∫ + —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –∑–∞–¥–∞–Ω–∏–µ)
# OpenAI —É–∂–µ –¥–æ–ª–∂–µ–Ω –≤–µ—Ä–Ω—É—Ç—å —Ç–µ–∫—Å—Ç —Å –Ω—É–∂–Ω—ã–º–∏ –∑–∞–≥–æ–ª–æ–≤–∫–∞–º–∏ –∏ —ç–º–æ–¥–∑–∏ –ø–æ –ø—Ä–æ–º–ø—Ç—É.
# –ü–æ—ç—Ç–æ–º—É –ø—Ä–æ—Å—Ç–æ –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º —Ç–æ, —á—Ç–æ —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–æ, –¥–æ–±–∞–≤–∏–≤ –≥–ª–∞–≤–Ω—ã–π –∑–∞–≥–æ–ª–æ–≤–æ–∫.

final_task_post = f"{task_post_header}\n\n{generated_task_text}"

try:
    bot.send_message(chat_id=chat_id, text=final_task_post, parse_mode='MarkdownV2')
    print("–ó–∞–¥–∞–Ω–∏–µ –¥–Ω—è –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ.")
except telegram.error.BadRequest as e:
    print(f"–û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ –∑–∞–¥–∞–Ω–∏—è –¥–Ω—è —Å MarkdownV2: {e}")
    # –ü–æ–ø—ã—Ç–∫–∞ –æ—Ç–ø—Ä–∞–≤–∏—Ç—å –±–µ–∑ —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∏–ª–∏ —Å HTML, –µ—Å–ª–∏ MarkdownV2 –Ω–µ —É–¥–∞–ª—Å—è
    # –£–±–∏—Ä–∞–µ–º Markdown –∏–∑ —Ç–µ–∫—Å—Ç–∞ –ø–µ—Ä–µ–¥ –ø–æ–≤—Ç–æ—Ä–Ω–æ–π –æ—Ç–ø—Ä–∞–≤–∫–æ–π
    # –ü—Ä–æ—Å—Ç–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ –∑–≤–µ–∑–¥–æ—á–µ–∫ –¥–ª—è –∂–∏—Ä–Ω–æ–≥–æ —Ç–µ–∫—Å—Ç–∞ –∏ –ø–æ–¥—á–µ—Ä–∫–∏–≤–∞–Ω–∏–π –¥–ª—è –∫—É—Ä—Å–∏–≤–∞, –µ—Å–ª–∏ –æ–Ω–∏ –µ—Å—Ç—å
    # –¢–µ–ª–µ–≥—Ä–∞–º –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Å–≤–æ–∏ –ø—Ä–∞–≤–∏–ª–∞ –¥–ª—è —ç–∫—Ä–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è, –ø–æ—ç—Ç–æ–º—É –ø—Ä–æ—Å—Ç–æ–π replace –º–æ–∂–µ—Ç –±—ã—Ç—å –Ω–µ–¥–æ—Å—Ç–∞—Ç–æ—á–µ–Ω
    # –¥–ª—è —Å–ª–æ–∂–Ω—ã—Ö —Å–ª—É—á–∞–µ–≤, –Ω–æ –¥–ª—è –Ω–∞—à–µ–≥–æ —Ñ–æ—Ä–º–∞—Ç–∞ –¥–æ–ª–∂–Ω–æ —Ö–≤–∞—Ç–∏—Ç—å.
    plain_text_task = generated_task_text # –ë–µ—Ä–µ–º —Ç–æ–ª—å–∫–æ —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Ç–µ–∫—Å—Ç –±–µ–∑ –Ω–∞—à–µ–≥–æ –∑–∞–≥–æ–ª–æ–≤–∫–∞
    plain_text_task = plain_text_task.replace("*", "").replace("_", "") # –£–¥–∞–ª—è–µ–º –æ—Å–Ω–æ–≤–Ω—ã–µ –º–∞—Ä–∫–¥–∞—É–Ω —Å–∏–º–≤–æ–ª—ã
    
    # –ü–µ—Ä–µ—Å–æ–±–∏—Ä–∞–µ–º –ø–æ—Å—Ç —Å –ø—Ä–æ—Å—Ç—ã–º —Ç–µ–∫—Å—Ç–æ–º
    plain_final_task_post = f"–ó–∞–¥–∞–Ω–∏–µ –¥–Ω—è: {selected_category.capitalize()}\n\n{plain_text_task}"

    bot.send_message(chat_id=chat_id, text=plain_final_task_post)
    print("–ó–∞–¥–∞–Ω–∏–µ –¥–Ω—è –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ –≤ –ø—Ä–æ—Å—Ç–æ–º —Ç–µ–∫—Å—Ç–æ–≤–æ–º —Ñ–æ—Ä–º–∞—Ç–µ –ø–æ—Å–ª–µ –æ—à–∏–±–∫–∏ Markdown.")
except Exception as e:
    print(f"–ù–µ–ø—Ä–µ–¥–≤–∏–¥–µ–Ω–Ω–∞—è –æ—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ –∑–∞–¥–∞–Ω–∏—è –¥–Ω—è: {e}")


print("–°–∫—Ä–∏–ø—Ç –∑–∞–≤–µ—Ä—à—ë–Ω.")
